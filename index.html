<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù„Ø¹Ø¨Ø© ØªØ·Ø§Ø¨Ù‚ Ø§Ù„Ø£Ø±Ù‚Ø§Ù…</title>

<style>
*{
    margin:0;
    padding:0;
    box-sizing:border-box;
}

body{
    font-family:Segoe UI,Tahoma;
    background:linear-gradient(135deg,#667eea,#764ba2);
    min-height:100vh;
    display:flex;
    justify-content:center;
    align-items:center;
    color:#fff;
    overflow:hidden;
}

.container{
    text-align:center;
    z-index:2;
}

h1{
    margin-bottom:20px;
}

.info{
    margin-bottom:15px;
    font-size:18px;
}

.game-board{
    display:grid;
    grid-template-columns:repeat(3,120px);
    gap:20px;
    padding:25px;
    background:rgba(255,255,255,0.15);
    border-radius:15px;
    justify-content:center;
    margin:0 auto;
}

.card{
    width:120px;
    height:120px;
    transform-style:preserve-3d;
    transition:transform 0.6s;
    cursor:pointer;
    position:relative;
}

.card.flipped{
    transform:rotateY(180deg);
}

.card.matched{
    opacity:0.6;
    pointer-events:none;
}

.card-face{
    position:absolute;
    width:100%;
    height:100%;
    backface-visibility:hidden;
    border-radius:10px;
    display:flex;
    justify-content:center;
    align-items:center;
    font-size:36px;
    font-weight:bold;
}

.card-front{
    background:#5a67d8;
}

.card-back{
    background:#fff;
    color:#000;
    transform:rotateY(180deg);
}

/* Ø´Ø§Ø´Ø© Ø§Ù„Ø§Ø­ØªÙØ§Ù„ */
.celebration{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,0.75);
    display:flex;
    justify-content:center;
    align-items:center;
    flex-direction:column;
    font-size:90px;
    font-weight:bold;
    color:#4ade80;
    text-shadow:0 0 25px #22c55e;
    animation:pop 0.5s ease;
    z-index:5;
}

@keyframes pop{
    from{transform:scale(0)}
    to{transform:scale(1)}
}

.hidden{
    display:none;
}

/* Confetti */
.confetti{
    position:fixed;
    width:10px;
    height:10px;
    top:-10px;
    animation:fall linear forwards;
}

@keyframes fall{
    to{
        transform:translateY(110vh) rotate(360deg);
        opacity:0;
    }
}

/* Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
.loading{
    text-align:center;
    font-size:24px;
}

/* Ø´Ø§Ø´Ø© Ø§Ù„Ø®Ø·Ø£ */
.error-screen{
    background:rgba(255,255,255,0.95);
    padding:40px;
    border-radius:15px;
    max-width:500px;
    color:#333;
}

.error-screen h2{
    color:#dc2626;
    margin-bottom:20px;
}

.error-screen p{
    color:#666;
    line-height:1.6;
    font-size:18px;
}
</style>
</head>

<body>

<!-- Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ -->
<div class="loading" id="loadingScreen">
    <p>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¬Ù‡Ø§Ø²...</p>
</div>

<!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø®Ø·Ø£ -->
<div class="error-screen hidden" id="errorScreen">
    <h2>âš ï¸ Ø¹Ø°Ø±Ø§Ù‹!</h2>
    <p>ÙŠØ¨Ø¯Ùˆ Ø£Ù†Ùƒ Ù„Ø¹Ø¨Øª Ù…Ù† Ù‚Ø¨Ù„ Ù…Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø².</p>
    <p>ÙƒÙ„ Ø´Ø®Øµ ÙŠÙ…ÙƒÙ†Ù‡ Ø§Ù„Ù„Ø¹Ø¨ Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø·. Ø´ÙƒØ±Ø§Ù‹ Ù„Ù…Ø´Ø§Ø±ÙƒØªÙƒ! ğŸ™</p>
</div>

<!-- Ø§Ù„Ù„Ø¹Ø¨Ø© -->
<div class="container hidden" id="gameContainer">
    <h1>ğŸ¯ Ù„Ø¹Ø¨Ø© ØªØ·Ø§Ø¨Ù‚ Ø§Ù„Ø£Ø±Ù‚Ø§Ù…</h1>

    <div class="info">
        Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª: <span id="attempts">0</span>
    </div>

    <div class="game-board" id="gameBoard"></div>
</div>

<!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø§Ø­ØªÙØ§Ù„ -->
<div class="celebration hidden" id="celebration">
    ğŸ‰ <span id="celebrationNumber"></span> ğŸ‰
    <div style="font-size:32px;margin-top:20px;">
        Ù…Ø¨Ø±ÙˆÙƒ ğŸŠ Ø£ÙˆÙ„ ØªØ·Ø§Ø¨Ù‚ ØµØ­!
    </div>
</div>

<script>
// 3 Ø£Ø±Ù‚Ø§Ù… Ã— 2 = 6 ÙƒØ±ÙˆØª
const numbers = [15, 20, 25];
const cards = [...numbers, ...numbers];

let flippedCards = [];
let attempts = 0;
let canFlip = true;
let gameOver = false;

// ============ Browser Fingerprinting ============

async function generateFingerprint() {
    const components = [];

    // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ØªØµÙØ­
    components.push(navigator.userAgent);
    components.push(navigator.language);
    components.push(navigator.platform);
    components.push(navigator.hardwareConcurrency || 0);
    components.push(navigator.deviceMemory || 0);

    // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø§Ø´Ø©
    components.push(screen.width);
    components.push(screen.height);
    components.push(screen.colorDepth);
    components.push(screen.pixelDepth);
    components.push(window.devicePixelRatio);

    // Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ©
    components.push(new Date().getTimezoneOffset());

    // Canvas Fingerprint
    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d');
    canvas.width = 200;
    canvas.height = 50;
    ctx.textBaseline = 'top';
    ctx.font = '14px Arial';
    ctx.fillStyle = '#f60';
    ctx.fillRect(125, 1, 62, 20);
    ctx.fillStyle = '#069';
    ctx.fillText('Browser Fingerprint', 2, 15);
    components.push(canvas.toDataURL());

    // WebGL Fingerprint
    try {
        const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
        if (gl) {
            const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
            if (debugInfo) {
                components.push(gl.getParameter(debugInfo.UNMASKED_VENDOR_WEBGL));
                components.push(gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL));
            }
        }
    } catch (e) {}

    // Fonts Detection
    const fonts = ['Arial', 'Verdana', 'Courier New', 'Georgia', 'Times New Roman'];
    const baseFonts = ['monospace', 'sans-serif', 'serif'];
    const testString = 'mmmmmmmmmmlli';
    const testSize = '72px';
    
    const span = document.createElement('span');
    span.style.fontSize = testSize;
    span.style.position = 'absolute';
    span.style.left = '-9999px';
    span.innerHTML = testString;
    document.body.appendChild(span);

    const detectedFonts = [];
    fonts.forEach(font => {
        baseFonts.forEach(baseFont => {
            span.style.fontFamily = `${font}, ${baseFont}`;
            detectedFonts.push(span.offsetWidth + 'x' + span.offsetHeight);
        });
    });
    document.body.removeChild(span);
    components.push(detectedFonts.join(','));

    // Plugins
    const plugins = Array.from(navigator.plugins || [])
        .map(p => p.name)
        .join(',');
    components.push(plugins);

    const fingerprint = await hashString(components.join('|||'));
    return fingerprint;
}

async function hashString(str) {
    const encoder = new TextEncoder();
    const data = encoder.encode(str);
    const hashBuffer = await crypto.subtle.digest('SHA-256', data);
    const hashArray = Array.from(new Uint8Array(hashBuffer));
    const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
    return hashHex;
}

function hasPlayed(fingerprint) {
    const players = JSON.parse(localStorage.getItem('playedFingerprints') || '[]');
    return players.includes(fingerprint);
}

function markAsPlayed(fingerprint) {
    const players = JSON.parse(localStorage.getItem('playedFingerprints') || '[]');
    players.push(fingerprint);
    localStorage.setItem('playedFingerprints', JSON.stringify(players));
}

async function checkDevice() {
    try {
        const fingerprint = await generateFingerprint();
        console.log('Device Fingerprint:', fingerprint);

        if (hasPlayed(fingerprint)) {
            // Ø§Ù„Ø¬Ù‡Ø§Ø² Ù„Ø¹Ø¨ Ù…Ù† Ù‚Ø¨Ù„
            document.getElementById('loadingScreen').classList.add('hidden');
            document.getElementById('errorScreen').classList.remove('hidden');
        } else {
            // Ø¬Ù‡Ø§Ø² Ø¬Ø¯ÙŠØ¯ - Ø­ÙØ¸ Ø§Ù„Ø¨ØµÙ…Ø© ÙˆØ¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©
            markAsPlayed(fingerprint);
            document.getElementById('loadingScreen').classList.add('hidden');
            document.getElementById('gameContainer').classList.remove('hidden');
            createBoard();
        }
    } catch (error) {
        console.error('Error generating fingerprint:', error);
        // ÙÙŠ Ø­Ø§Ù„Ø© Ø­Ø¯ÙˆØ« Ø®Ø·Ø£ØŒ Ù†Ø³Ù…Ø­ Ø¨Ø§Ù„Ù„Ø¹Ø¨
        document.getElementById('loadingScreen').classList.add('hidden');
        document.getElementById('gameContainer').classList.remove('hidden');
        createBoard();
    }
}

// ============ Game Logic ============

function shuffle(array){
    for(let i=array.length-1;i>0;i--){
        const j=Math.floor(Math.random()*(i+1));
        [array[i],array[j]]=[array[j],array[i]];
    }
    return array;
}

function createBoard(){
    const board = document.getElementById("gameBoard");
    shuffle(cards).forEach((number)=>{
        const card = document.createElement("div");
        card.className="card";
        card.dataset.number=number;

        card.innerHTML=`
            <div class="card-face card-front">?</div>
            <div class="card-face card-back">${number}</div>
        `;

        card.addEventListener("click", flipCard);
        board.appendChild(card);
    });
}

function flipCard(){
    if(gameOver || !canFlip || this.classList.contains("matched")) return;
    if(flippedCards.includes(this)) return;

    this.classList.add("flipped");
    flippedCards.push(this);

    if(flippedCards.length === 2){
        canFlip = false;
        attempts++;
        document.getElementById("attempts").textContent = attempts;
        checkMatch();
    }
}

function checkMatch(){
    const [card1, card2] = flippedCards;

    if(card1.dataset.number === card2.dataset.number){
        gameOver = true;

        card1.classList.add("matched");
        card2.classList.add("matched");

        showCelebration(card1.dataset.number);
    }else{
        setTimeout(()=>{
            card1.classList.remove("flipped");
            card2.classList.remove("flipped");
            flippedCards = [];
            canFlip = true;
        }, 1000);
    }
}

function showCelebration(number){
    document.getElementById("celebrationNumber").textContent = number;
    document.getElementById("celebration").classList.remove("hidden");
    createConfetti();
}

function createConfetti(){
    for(let i=0;i<70;i++){
        const confetti = document.createElement("div");
        confetti.className = "confetti";
        confetti.style.left = Math.random()*100 + "vw";
        confetti.style.backgroundColor = `hsl(${Math.random()*360},100%,50%)`;
        confetti.style.animationDuration = (Math.random()*2 + 1) + "s";
        document.body.appendChild(confetti);

        setTimeout(()=>confetti.remove(),3000);
    }
}

// Ø¨Ø¯Ø¡ Ø§Ù„ÙØ­Øµ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
checkDevice();
</script>

</body>
</html>