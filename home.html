<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù„Ø¹Ø¨Ø© Ø§Ù„Ø¨Ø§Ø²Ù„ Ø¨Ø§Ù„Ø³Ø­Ø¨</title>
<style>
  body {
    display:flex;
    flex-direction:column;
    justify-content:center;
    align-items:center;
    height:100vh;
    font-family: 'Segoe UI', sans-serif;
    background: linear-gradient(135deg,#667eea,#764ba2);
    color:#fff;
    overflow:hidden;
  }

  h1 { margin-bottom: 20px; }
  #timer { margin-bottom: 20px; font-size: 20px; }

  #puzzle-container {
    width: 360px;
    height: 360px;
    display:grid;
    grid-template-columns: repeat(3, 120px);
    grid-template-rows: repeat(3, 120px);
    gap:2px;
    background:#fff;
    padding:2px;
    border-radius:15px;
    box-shadow:0 5px 15px rgba(0,0,0,0.3);
    position: relative;
  }

  .slot {
    width:120px;
    height:120px;
    border-radius:10px;
    background: #ddd;
    position: relative;
  }

  .piece {
    width:120px;
    height:120px;
    border-radius:10px;
    position:absolute;
    cursor:grab;
    background-size: 360px 360px;
    box-shadow:0 3px 6px rgba(0,0,0,0.2);
    transition:0.2s;
  }

  .piece.dragging {
    opacity:0.7;
    z-index:100;
  }

  /* Confetti */
  .confetti {
    position: absolute;
    width: 10px;
    height: 10px;
    background-color: #ffeb3b;
    top: 0;
    left: 50%;
    opacity: 0.8;
    animation: fall 3s linear forwards;
  }

  @keyframes fall {
    to {
      transform: translateY(400px) rotate(720deg);
      opacity: 0;
    }
  }
</style>
</head>
<body>

<h1>Ù„Ø¹Ø¨Ø© Ø§Ù„Ø¨Ø§Ø²Ù„ Ø¨Ø§Ù„Ø³Ø­Ø¨</h1>
<div id="timer">Ø§Ù„ÙˆÙ‚Øª: 0 Ø«Ø§Ù†ÙŠØ©</div>
<div id="puzzle-container"></div>

<script>
const container = document.getElementById('puzzle-container');
const timerDisplay = document.getElementById('timer');
const imageUrl = 'https://i.imgur.com/8Km9tLL.jpg'; // Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©

let positions = [];
for(let i=0;i<9;i++) positions.push(i);

// Ø¥Ù†Ø´Ø§Ø¡ 9 Ø³Ù„ÙˆØªØ§Øª ÙØ§Ø±ØºØ©
for(let i=0;i<9;i++){
  const slot = document.createElement('div');
  slot.classList.add('slot');
  slot.dataset.index = i;
  container.appendChild(slot);
}

// Ø®Ù„Ø· Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© Ù„Ù„Ù‚Ø·Ø¹
function shuffle(array) {
  for (let i = array.length -1; i>0; i--){
    const j = Math.floor(Math.random()*(i+1));
    [array[i], array[j]] = [array[j], array[i]];
  }
}
shuffle(positions);

// Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù‚Ø·Ø¹ ÙˆÙˆØ¶Ø¹Ù‡Ø§ Ø¨Ø´ÙƒÙ„ Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ø¯Ø§Ø®Ù„ Ø§Ù„Ø­Ø§ÙˆÙŠØ©
const pieces = [];
for(let i=0;i<9;i++){
  const piece = document.createElement('div');
  piece.classList.add('piece');
  piece.style.backgroundImage = `url(${imageUrl})`;
  piece.style.backgroundPosition = `-${(i%3)*120}px -${Math.floor(i/3)*120}px`;

  // Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© Ù„Ù„Ø®Ù„Ø·
  piece.style.left = `${Math.floor(Math.random()*240)}px`;
  piece.style.top = `${Math.floor(Math.random()*240)}px`;

  piece.dataset.correctIndex = i;
  container.appendChild(piece);
  pieces.push(piece);
}

// Ø§Ù„Ø¯Ø±Ø§Ø¬ Ø¢Ù†Ø¯ Ø¯Ø±ÙˆØ¨
let dragPiece = null;
let offsetX = 0;
let offsetY = 0;

pieces.forEach(piece=>{
  piece.addEventListener('mousedown', e=>{
    dragPiece = piece;
    dragPiece.classList.add('dragging');
    offsetX = e.offsetX;
    offsetY = e.offsetY;
  });
});

document.addEventListener('mousemove', e=>{
  if(dragPiece){
    const rect = container.getBoundingClientRect();
    let x = e.clientX - rect.left - offsetX;
    let y = e.clientY - rect.top - offsetY;

    // Ø¶Ø¨Ø· Ø§Ù„Ø­Ø¯ÙˆØ¯
    x = Math.max(0, Math.min(x, container.clientWidth - 120));
    y = Math.max(0, Math.min(y, container.clientHeight - 120));

    dragPiece.style.left = x + 'px';
    dragPiece.style.top = y + 'px';
  }
});

document.addEventListener('mouseup', e=>{
  if(dragPiece){
    const rects = Array.from(container.querySelectorAll('.slot')).map(s=>s.getBoundingClientRect());
    let closest = null;
    let minDist = Infinity;
    const pieceRect = dragPiece.getBoundingClientRect();

    rects.forEach((r,i)=>{
      const dx = (pieceRect.left + 60) - (r.left + 60);
      const dy = (pieceRect.top + 60) - (r.top + 60);
      const dist = Math.sqrt(dx*dx + dy*dy);
      if(dist<minDist){
        minDist = dist;
        closest = container.querySelectorAll('.slot')[i];
      }
    });

    if(minDist < 60){
      dragPiece.style.left = closest.offsetLeft + 'px';
      dragPiece.style.top = closest.offsetTop + 'px';
    }

    dragPiece.classList.remove('dragging');
    dragPiece = null;

    checkWin();
  }
});

// Ø¹Ø¯Ø§Ø¯ Ø§Ù„ÙˆÙ‚Øª
let seconds = 0;
const timerInterval = setInterval(()=>{
  seconds++;
  timerDisplay.textContent = `Ø§Ù„ÙˆÙ‚Øª: ${seconds} Ø«Ø§Ù†ÙŠØ©`;
},1000);

// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙÙˆØ² Ù…Ø¹ Ø§Ø­ØªÙØ§Ù„
function checkWin(){
  let won = true;
  pieces.forEach(p=>{
    const left = parseInt(p.style.left);
    const top = parseInt(p.style.top);
    const correctLeft = (p.dataset.correctIndex %3)*120;
    const correctTop = Math.floor(p.dataset.correctIndex /3)*120;
    if(left !== correctLeft || top !== correctTop) won = false;
  });
  if(won){
    clearInterval(timerInterval);
    celebrate();
    setTimeout(()=>alert(`ğŸ‰ Ù…Ø¨Ø±ÙˆÙƒ! Ø£ÙƒÙ…Ù„Øª Ø§Ù„ØµÙˆØ±Ø© ÙÙŠ ${seconds} Ø«Ø§Ù†ÙŠØ© ğŸ‰`), 100);
  }
}

// ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø§Ø­ØªÙØ§Ù„
function celebrate(){
  for(let i=0;i<100;i++){
    const confetti = document.createElement('div');
    confetti.classList.add('confetti');
    confetti.style.backgroundColor = `hsl(${Math.random()*360}, 80%, 60%)`;
    confetti.style.left = Math.random()*360 + 'px';
    confetti.style.top = '0px';
    document.body.appendChild(confetti);
    setTimeout(()=> confetti.remove(),3000);
  }
}
</script>

</body>
</html>
